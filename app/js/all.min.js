'use strict';

;(function () {
    "use strict";

    (function () {
        var burger = document.querySelector('.burger-container'),
            hamburger = document.querySelector('.hamburger'),
            titleItem = document.querySelectorAll('.titleul-item a');

        console.log("burger");

        burger.addEventListener('click', function () {
            hamburger.classList.toggle('titleul-opened');
        });

        for (var i = 0; i < titleItem.length; i++) {
            titleItem[i].onclick = function () {
                hamburger.classList.toggle('titleul-opened');
            };
        }
    })();

    var myslider = function SliderClass() {
        var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

        var defaultOptions = {
            time: 4000,
            sliderr: '.slider',
            slidess: '.slider .block',
            activeClass: 'active',
            dotActiveClass: '.act_s'
        };
        var o = Object.assign({}, defaultOptions, options);
        var slider = angular.element(document.querySelector(o.sliderr));
        var slides = angular.element(document.querySelectorAll(o.slidess));
        var dots = angular.element(document.querySelectorAll(o.dotActiveClass));
        var curSlide = 0;
        function SetActiveSlide(num) {
            [].forEach.call(slides, function (item) {
                item.classList.remove(o.activeClass);
            });

            [].forEach.call(dots, function (i) {
                i.classList.remove(o.activeClass);
            });

            slides[num].classList.add(o.activeClass);
            dots[num].classList.add(o.activeClass);
            curSlide = num;
        }

        function nextSlide() {
            slides[curSlide].classList.remove(o.activeClass);
            dots[curSlide].classList.remove(o.activeClass);
            curSlide = curSlide < slides.length - 1 ? ++curSlide : 0;
            slides[curSlide].classList.add(o.activeClass);
            dots[curSlide].classList.add(o.activeClass);
        }

        function prevSlide() {
            slides[curSlide].classList.remove(o.activeClass);
            dots[curSlide].classList.remove(o.activeClass);
            curSlide = curSlide == 0 ? slides.length - 1 : --curSlide;
            slides[curSlide].classList.add(o.activeClass);
            dots[curSlide].classList.add(o.activeClass);
        }

        var timeId = void 0;

        function autoplay() {
            timeId = setInterval(nextSlide, o.time);
        }

        function stopAutoplay() {
            clearInterval(timeId);
        }

        function createDots() {
            var dotConteiner = angular.element(document.querySelector(o.dotActiveClass));
            [].forEach.call(slides, function (item, ind) {
                var dot = document.createElement('div');
                dot.classList.add(o.dotActiveClass);
                dot.addEventListener('click', function () {
                    SetActiveSlide(ind);
                });
            });
        }; // createDots();

        return {
            nextSlide: nextSlide,
            prevSlide: prevSlide,
            autoplay: autoplay,
            stopAutoplay: stopAutoplay,
            SetActiveSlide: SetActiveSlide
        };
    }();

    (function () {
        var left = angular.element(document.querySelector('.slider .LeftRight .prev')),
            right = angular.element(document.querySelector('.slider .LeftRight .next')),
            dot = angular.element(document.querySelectorAll('.act_s'));

        left.on('click', function (event) {
            event.preventDefault();
            myslider.stopAutoplay();
            myslider.prevSlide();
            myslider.autoplay();
        });
        right.on('click', function (event) {
            event.preventDefault();
            myslider.stopAutoplay();
            myslider.nextSlide();
            myslider.autoplay();
        });

        var _loop = function _loop(i) {
            dot[i].addEventListener('click', function (event) {
                event.preventDefault();
                myslider.stopAutoplay();
                myslider.SetActiveSlide(i);
                myslider.autoplay();
            });
        };

        for (var i = 0; i < dot.length; ++i) {
            _loop(i);
        }

        myslider.autoplay();
    })();
    /*
    (function(){
        const speed = 6;
        let top = 0,
            src;
        console.log("dsda");
        [].forEach.call(document.querySelectorAll('.move-to'), (item) => {
            const target = document.getElementById(item.getAttribute('href').split('#')[1]);
            item.addEventListener('click', (event) => {
                event.preventDefault();
                let topvalue = Math.abs(target.offsetTop);
                console.log(top);
                console.log(topvalue);
                let y = top;
                if (top > topvalue) {
                    src = setInterval( function () {
                        top -= 10;
                        window.scrollTo(0,top);
                        if (top <= topvalue) {
                            clearInterval(src);
                            top = topvalue;
                        }
                    },speed);
                }
                else {
                    src = setInterval(function () {
                        top +=10;
                        window.scrollTo(0, top);
                        if (top >= topvalue) {
                            clearInterval(src);
                        }
                    }, speed);
                }
            });
        });
    }());
    */
    function showA() {
        var form = angular.element(document.querySelector('.popup')),
            menu = angular.element(document.querySelector('.header .menu ul'));
        form.css("display", "block");
        menu.css("zIndex", "0");
        //form.style.display = "block";
        //menu.style.zIndex = "0";
        setTimeout(function () {
            form.addClass("active");
        }, 0);
    };

    function hidenA() {
        var form = angular.element(document.querySelector('.popup')),
            menu = angular.element(document.querySelector('.header .menu ul'));
        setTimeout(function () {
            form.css("display", "none");
        }, 1200);
        form.removeClass("active");
        menu.css("zIndex", "2");
    };

    // Анимация закрытия формы, конечно, не самая лучшая, но хотя бы работает 

    function resetInput() {
        var userName = document.getElementById('userName'),
            userPhone = document.getElementById('userPhone'),
            userEmail = document.getElementById('userEmail'),
            textbox = document.getElementById('textbox'),
            menu = document.querySelector('.header .menu ul'),
            trueborder = "rgba(0,0,0,0.3) 2px solid";

        userName.value = "";
        userPhone.value = "";
        userEmail.value = "";
        userName.style.border = trueborder;
        userPhone.style.border = trueborder;
        userEmail.style.border = trueborder;
    }

    (function () {
        var pop = angular.element(document.getElementById('lowly')),
            cancel = angular.element(document.getElementById('cancel')),
            form = angular.element(document.querySelector('.popup')),
            fone = angular.element(document.querySelector('.popup_bg')),
            submit = angular.element(document.getElementById('subway'));
        console.log("sdsasdas");
        pop.on('click', function (event) {
            event.preventDefault();
            console.log("Yep");
            showA();
        });

        fone.on('click', function (event) {
            hidenA();
            resetInput();
        });

        cancel.on('click', function (event) {
            event.preventDefault();
            hidenA();
            resetInput();
        });
    })();

    (function () {
        var menu = angular.element(document.querySelector('.header .menu ul')),
            text = angular.element(document.querySelectorAll('.header .menu a'));
        console.log("SCROOL");
        window.addEventListener('scroll', function (event) {
            if (window.scrollY >= 600 && window.innerWidth > 589) {
                //form.css("display", "block");
                menu.css("position", "fixed");
                menu.css("borderRadius", "5px");
                menu.css("background", "#17daa3");
                menu.css("border", "#17daa3 5px solid");
                menu.css("minHeight", "0px");
            } else {
                menu.css("position", "relative");
                menu.css("borderRadius", "");
                menu.css("border", "");
                menu.css("background", "");
                menu.css("minHeight", "100px");
            }
        });
    })();

    (function CheckFormInputs() {
        var falseborder = "#ff6666 3px solid";
        var trueborder = "rgba(0,0,0,0.3) 2px solid";
        var submit = document.getElementById('subway'),
            userName = document.getElementById('userName'),
            userPhone = document.getElementById('userPhone'),
            userEmail = document.getElementById('userEmail'),
            checkName = /^[a-z-а-яё]+$/i,
            checkEmail = /^[\w]{1}[\w-\.]*@[\w-]+\.[a-z]{2,3}$/i,
            boolName = false,
            boolEmail = false;

        userPhone.onkeypress = function (e) {
            if (e.ctrlKey || e.altKey || e.metaKey) return;
            if (e.charCode < 48 || e.charCode > 57) {
                return false;
            }
        };

        submit.addEventListener('click', function (event) {
            event.preventDefault();
            boolEmail = checkEmail.test(userEmail.value);
            boolName = checkName.test(userName.value);

            if (!userName.value || !boolName) {
                userName.style.border = falseborder;
                return false;
            } else {
                userName.style.border = trueborder;
            }

            if (!userPhone.value || userPhone.value.length > 14) {
                userPhone.style.border = falseborder;
                return false;
            } else {
                userPhone.style.border = trueborder;
            }

            if (!userEmail.value || !boolEmail) {
                userEmail.style.border = falseborder;
                return false;
            } else {
                userEmail.style.border = trueborder;
            }
            console.log(userName.value + ' ' + userPhone.value + ' ' + userEmail.value);
            hidenA();
            resetInput();
        });
    })();

    (function () {
        var pop = angular.element(document.querySelector('.jsonformat')),
            xhr = new XMLHttpRequest();
        xhr.open('GET', '../info.json', true);
        xhr.send();
        xhr.onreadystatechange = function () {
            if (xhr.readyState != 4) return;
            if (xhr.status != 200) {
                alert(xhr.status + ': ' + xhr.statusText);
            } else {
                var out = "<p>",
                    info = JSON.parse(xhr.responseText);
                out += info.mapinfo + "</p>";
                var newDiv = angular.element(out);
                console.log("XHR is good");
                pop.append(out);
                //pop.text(out);
                console.log(pop);
            }
        };
    })();
})();